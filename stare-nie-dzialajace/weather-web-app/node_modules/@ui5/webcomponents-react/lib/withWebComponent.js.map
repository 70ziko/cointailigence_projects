{"version":3,"file":"withWebComponent.js","sources":["../src/internal/withWebComponent.tsx"],"sourcesContent":["import { useConsolidatedRef } from '@ui5/webcomponents-react-base/lib/useConsolidatedRef';\nimport React, {\n  Children,\n  cloneElement,\n  forwardRef,\n  ForwardRefRenderFunction,\n  HTMLAttributes,\n  ReactElement,\n  Ref,\n  RefObject,\n  useEffect,\n  useRef\n} from 'react';\nimport { CommonProps } from '../interfaces/CommonProps';\nimport { Ui5DomRef } from '../interfaces/Ui5DomRef';\n\nconst capitalizeFirstLetter = (s: string) => s.charAt(0).toUpperCase() + s.slice(1);\n\nconst camelToKebabCase = (s: string) => s.replace(/([A-Z])/g, (a, b: string) => `-${b.toLowerCase()}`);\nconst kebabToCamelCase = (str: string) => str.replace(/([-_]\\w)/g, (g) => g[1].toUpperCase());\n\nconst createEventPropName = (eventName) => `on${capitalizeFirstLetter(kebabToCamelCase(eventName))}`;\n\ntype EventHandler = (event: CustomEvent<unknown>) => void;\n\nexport interface WithWebComponentPropTypes extends CommonProps {\n  ref?: Ref<any>;\n  children?: any | void;\n}\n\nexport const withWebComponent = <T extends Record<string, any>>(\n  TagName: string,\n  regularProperties: string[],\n  booleanProperties: string[],\n  slotProperties: string[],\n  eventProperties: string[]\n) => {\n  const WithWebComponent = forwardRef((props: T & WithWebComponentPropTypes, wcRef: RefObject<Ui5DomRef>) => {\n    const { className, tooltip, children, ...rest } = props;\n\n    const ref = useConsolidatedRef<HTMLElement>(wcRef);\n    const eventRegistry = useRef<Record<string, EventHandler>>({});\n\n    // regular props (no booleans, no slots and no events)\n    const regularProps = regularProperties.reduce((acc, name) => {\n      if (rest.hasOwnProperty(name)) {\n        return { ...acc, [camelToKebabCase(name)]: rest[name] };\n      }\n      return acc;\n    }, {});\n\n    // boolean properties - only attach if they are truthy\n    const booleanProps = booleanProperties.reduce((acc, name) => {\n      if (rest[name] === true || rest[name] === 'true') {\n        return { ...acc, [camelToKebabCase(name)]: true };\n      }\n      return acc;\n    }, {});\n\n    const slots = slotProperties.reduce((acc, name) => {\n      const slotValue = rest[name] as ReactElement;\n      if (slotValue) {\n        return [\n          ...acc,\n          ...Children.map(\n            slotValue?.type === React.Fragment ? slotValue.props?.children : slotValue,\n            (item: ReactElement, index) =>\n              cloneElement(item, {\n                key: `${name}-${index}`,\n                slot: name\n              })\n          )\n        ];\n      }\n      return acc;\n    }, []);\n\n    // event binding\n    useEffect(\n      () => {\n        eventProperties.forEach((eventName) => {\n          const eventHandler = rest[createEventPropName(eventName)] as EventHandler;\n          if (typeof eventHandler === 'function') {\n            eventRegistry.current[eventName] = eventHandler;\n            ref.current.addEventListener(eventName, eventRegistry.current[eventName]);\n          }\n        });\n\n        return () => {\n          // eslint-disable-next-line guard-for-in\n          for (const eventName in eventRegistry.current) {\n            ref.current?.removeEventListener(eventName, eventRegistry.current[eventName]);\n          }\n        };\n      },\n      eventProperties.map((eventName) => rest[createEventPropName(eventName)])\n    );\n\n    // non web component related props, just pass them\n    const nonWebComponentRelatedProps = Object.entries(rest)\n      .filter(([key]) => !regularProperties.includes(key))\n      .filter(([key]) => !slotProperties.includes(key))\n      .filter(([key]) => !booleanProperties.includes(key))\n      .filter(([key]) => !eventProperties.map((eventName) => createEventPropName(eventName)).includes(key))\n      .reduce((acc, [key, val]) => ({ ...acc, [key]: val }), {});\n\n    return (\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n      // @ts-ignore\n      <TagName\n        ref={ref}\n        {...booleanProps}\n        {...regularProps}\n        {...nonWebComponentRelatedProps}\n        class={className}\n        title={tooltip}\n      >\n        {slots}\n        {children}\n      </TagName>\n    );\n  });\n\n  WithWebComponent.displayName = `WithWebComponent(${TagName})`;\n\n  return (WithWebComponent as unknown) as ForwardRefRenderFunction<Ui5DomRef, T & WithWebComponentPropTypes>;\n};\n"],"names":["capitalizeFirstLetter","s","charAt","toUpperCase","slice","camelToKebabCase","replace","a","b","toLowerCase","kebabToCamelCase","str","g","createEventPropName","eventName","withWebComponent","TagName","regularProperties","booleanProperties","slotProperties","eventProperties","WithWebComponent","forwardRef","props","wcRef","className","tooltip","children","rest","ref","useConsolidatedRef","eventRegistry","useRef","regularProps","reduce","acc","name","hasOwnProperty","booleanProps","slots","slotValue","Children","map","type","React","Fragment","item","index","cloneElement","key","slot","useEffect","forEach","eventHandler","current","addEventListener","removeEventListener","nonWebComponentRelatedProps","Object","entries","filter","includes","val","displayName"],"mappings":";;;;;;;;;AAgBA,IAAMA,qBAAqB,GAAG,SAAxBA,qBAAwB,CAACC,CAAD;AAAA,SAAeA,CAAC,CAACC,MAAF,CAAS,CAAT,EAAYC,WAAZ,KAA4BF,CAAC,CAACG,KAAF,CAAQ,CAAR,CAA3C;AAAA,CAA9B;;AAEA,IAAMC,gBAAgB,GAAG,SAAnBA,gBAAmB,CAACJ,CAAD;AAAA,SAAeA,CAAC,CAACK,OAAF,CAAU,UAAV,EAAsB,UAACC,CAAD,EAAIC,CAAJ;AAAA,sBAAsBA,CAAC,CAACC,WAAF,EAAtB;AAAA,GAAtB,CAAf;AAAA,CAAzB;;AACA,IAAMC,gBAAgB,GAAG,SAAnBA,gBAAmB,CAACC,GAAD;AAAA,SAAiBA,GAAG,CAACL,OAAJ,CAAY,WAAZ,EAAyB,UAACM,CAAD;AAAA,WAAOA,CAAC,CAAC,CAAD,CAAD,CAAKT,WAAL,EAAP;AAAA,GAAzB,CAAjB;AAAA,CAAzB;;AAEA,IAAMU,mBAAmB,GAAG,SAAtBA,mBAAsB,CAACC,SAAD;AAAA,qBAAoBd,qBAAqB,CAACU,gBAAgB,CAACI,SAAD,CAAjB,CAAzC;AAAA,CAA5B;;IASaC,gBAAgB,GAAG,SAAnBA,gBAAmB,CAC9BC,OAD8B,EAE9BC,iBAF8B,EAG9BC,iBAH8B,EAI9BC,cAJ8B,EAK9BC,eAL8B,EAM3B;AACH,MAAMC,gBAAgB,gBAAGC,UAAU,CAAC,UAACC,KAAD,EAAuCC,KAAvC,EAAuE;AAAA,QACjGC,SADiG,GACvDF,KADuD,CACjGE,SADiG;AAAA,QACtFC,OADsF,GACvDH,KADuD,CACtFG,OADsF;AAAA,QAC7EC,QAD6E,GACvDJ,KADuD,CAC7EI,QAD6E;AAAA,QAChEC,IADgE,4BACvDL,KADuD;;AAGzG,QAAMM,GAAG,GAAGC,kBAAkB,CAAcN,KAAd,CAA9B;AACA,QAAMO,aAAa,GAAGC,MAAM,CAA+B,EAA/B,CAA5B,CAJyG;;AAOzG,QAAMC,YAAY,GAAGhB,iBAAiB,CAACiB,MAAlB,CAAyB,UAACC,GAAD,EAAMC,IAAN,EAAe;AAC3D,UAAIR,IAAI,CAACS,cAAL,CAAoBD,IAApB,CAAJ,EAA+B;AAC7B,+CAAYD,GAAZ,2BAAkB9B,gBAAgB,CAAC+B,IAAD,CAAlC,EAA2CR,IAAI,CAACQ,IAAD,CAA/C;AACD;;AACD,aAAOD,GAAP;AACD,KALoB,EAKlB,EALkB,CAArB,CAPyG;;AAezG,QAAMG,YAAY,GAAGpB,iBAAiB,CAACgB,MAAlB,CAAyB,UAACC,GAAD,EAAMC,IAAN,EAAe;AAC3D,UAAIR,IAAI,CAACQ,IAAD,CAAJ,KAAe,IAAf,IAAuBR,IAAI,CAACQ,IAAD,CAAJ,KAAe,MAA1C,EAAkD;AAChD,+CAAYD,GAAZ,2BAAkB9B,gBAAgB,CAAC+B,IAAD,CAAlC,EAA2C,IAA3C;AACD;;AACD,aAAOD,GAAP;AACD,KALoB,EAKlB,EALkB,CAArB;AAOA,QAAMI,KAAK,GAAGpB,cAAc,CAACe,MAAf,CAAsB,UAACC,GAAD,EAAMC,IAAN,EAAe;AACjD,UAAMI,SAAS,GAAGZ,IAAI,CAACQ,IAAD,CAAtB;;AACA,UAAII,SAAJ,EAAe;AAAA;;AACb,4CACKL,GADL,sBAEKM,QAAQ,CAACC,GAAT,CACD,CAAAF,SAAS,SAAT,IAAAA,SAAS,WAAT,YAAAA,SAAS,CAAEG,IAAX,MAAoBC,KAAK,CAACC,QAA1B,uBAAqCL,SAAS,CAACjB,KAA/C,qDAAqC,iBAAiBI,QAAtD,GAAiEa,SADhE,EAED,UAACM,IAAD,EAAqBC,KAArB;AAAA,8BACEC,YAAY,CAACF,IAAD,EAAO;AACjBG,YAAAA,GAAG,YAAKb,IAAL,cAAaW,KAAb,CADc;AAEjBG,YAAAA,IAAI,EAAEd;AAFW,WAAP,CADd;AAAA,SAFC,CAFL;AAWD;;AACD,aAAOD,GAAP;AACD,KAhBa,EAgBX,EAhBW,CAAd,CAtByG;;AAyCzGgB,IAAAA,SAAS,CACP,YAAM;AACJ/B,MAAAA,eAAe,CAACgC,OAAhB,CAAwB,UAACtC,SAAD,EAAe;AACrC,YAAMuC,YAAY,GAAGzB,IAAI,CAACf,mBAAmB,CAACC,SAAD,CAApB,CAAzB;;AACA,YAAI,OAAOuC,YAAP,KAAwB,UAA5B,EAAwC;AACtCtB,UAAAA,aAAa,CAACuB,OAAd,CAAsBxC,SAAtB,IAAmCuC,YAAnC;AACAxB,UAAAA,GAAG,CAACyB,OAAJ,CAAYC,gBAAZ,CAA6BzC,SAA7B,EAAwCiB,aAAa,CAACuB,OAAd,CAAsBxC,SAAtB,CAAxC;AACD;AACF,OAND;AAQA,aAAO,YAAM;AACX;AACA,aAAK,IAAMA,SAAX,IAAwBiB,aAAa,CAACuB,OAAtC,EAA+C;AAAA;;AAC7C,0BAAAzB,GAAG,CAACyB,OAAJ,8DAAaE,mBAAb,CAAiC1C,SAAjC,EAA4CiB,aAAa,CAACuB,OAAd,CAAsBxC,SAAtB,CAA5C;AACD;AACF,OALD;AAMD,KAhBM,EAiBPM,eAAe,CAACsB,GAAhB,CAAoB,UAAC5B,SAAD;AAAA,aAAec,IAAI,CAACf,mBAAmB,CAACC,SAAD,CAApB,CAAnB;AAAA,KAApB,CAjBO,CAAT,CAzCyG;;AA8DzG,QAAM2C,2BAA2B,GAAGC,MAAM,CAACC,OAAP,CAAe/B,IAAf,EACjCgC,MADiC,CAC1B;AAAA;AAAA,UAAEX,GAAF;;AAAA,aAAW,CAAChC,iBAAiB,CAAC4C,QAAlB,CAA2BZ,GAA3B,CAAZ;AAAA,KAD0B,EAEjCW,MAFiC,CAE1B;AAAA;AAAA,UAAEX,GAAF;;AAAA,aAAW,CAAC9B,cAAc,CAAC0C,QAAf,CAAwBZ,GAAxB,CAAZ;AAAA,KAF0B,EAGjCW,MAHiC,CAG1B;AAAA;AAAA,UAAEX,GAAF;;AAAA,aAAW,CAAC/B,iBAAiB,CAAC2C,QAAlB,CAA2BZ,GAA3B,CAAZ;AAAA,KAH0B,EAIjCW,MAJiC,CAI1B;AAAA;AAAA,UAAEX,GAAF;;AAAA,aAAW,CAAC7B,eAAe,CAACsB,GAAhB,CAAoB,UAAC5B,SAAD;AAAA,eAAeD,mBAAmB,CAACC,SAAD,CAAlC;AAAA,OAApB,EAAmE+C,QAAnE,CAA4EZ,GAA5E,CAAZ;AAAA,KAJ0B,EAKjCf,MALiC,CAK1B,UAACC,GAAD;AAAA;AAAA,UAAOc,GAAP;AAAA,UAAYa,GAAZ;;AAAA,6CAA2B3B,GAA3B,2BAAiCc,GAAjC,EAAuCa,GAAvC;AAAA,KAL0B,EAKqB,EALrB,CAApC;AAOA;AAAA;AACE;AACA;AACA,0BAAC,OAAD;AACE,QAAA,GAAG,EAAEjC;AADP,SAEMS,YAFN,EAGML,YAHN,EAIMwB,2BAJN;AAKE,iBAAOhC,SALT;AAME,QAAA,KAAK,EAAEC;AANT,UAQGa,KARH,EASGZ,QATH;AAHF;AAeD,GApFkC,CAAnC;AAsFAN,EAAAA,gBAAgB,CAAC0C,WAAjB,8BAAmD/C,OAAnD;AAEA,SAAQK,gBAAR;AACD;;;;"}