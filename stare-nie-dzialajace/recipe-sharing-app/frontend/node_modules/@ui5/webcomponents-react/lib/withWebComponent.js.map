{"version":3,"file":"withWebComponent.js","sources":["../src/internal/withWebComponent.tsx"],"sourcesContent":["import { getEffectiveScopingSuffixForTag } from '@ui5/webcomponents-base/dist/CustomElementsScope';\nimport { useConsolidatedRef } from '@ui5/webcomponents-react-base/lib/useConsolidatedRef';\nimport React, {\n  Children,\n  cloneElement,\n  ComponentType,\n  forwardRef,\n  ForwardRefRenderFunction,\n  ReactElement,\n  Ref,\n  RefObject,\n  useEffect,\n  useRef\n} from 'react';\nimport { CommonProps } from '../interfaces/CommonProps';\nimport { Ui5DomRef } from '../interfaces/Ui5DomRef';\n\nconst capitalizeFirstLetter = (s: string) => s.charAt(0).toUpperCase() + s.slice(1);\n\nconst camelToKebabCase = (s: string) => s.replace(/([A-Z])/g, (a, b: string) => `-${b.toLowerCase()}`);\nconst kebabToCamelCase = (str: string) => str.replace(/([-_]\\w)/g, (g) => g[1].toUpperCase());\n\nconst createEventPropName = (eventName) => `on${capitalizeFirstLetter(kebabToCamelCase(eventName))}`;\n\ntype EventHandler = (event: CustomEvent<unknown>) => void;\n\nexport interface WithWebComponentPropTypes extends CommonProps {\n  ref?: Ref<any>;\n  children?: any | void;\n}\n\nexport const withWebComponent = <T extends Record<string, any>>(\n  tagName: string,\n  regularProperties: string[],\n  booleanProperties: string[],\n  slotProperties: string[],\n  eventProperties: string[]\n) => {\n  const WithWebComponent = forwardRef((props: T & WithWebComponentPropTypes, wcRef: RefObject<Ui5DomRef>) => {\n    const { className, tooltip, children, ...rest } = props;\n\n    const ref = useConsolidatedRef<HTMLElement>(wcRef);\n    const eventRegistry = useRef<Record<string, EventHandler>>({});\n\n    // regular props (no booleans, no slots and no events)\n    const regularProps = regularProperties.reduce((acc, name) => {\n      if (rest.hasOwnProperty(name)) {\n        return { ...acc, [camelToKebabCase(name)]: rest[name] };\n      }\n      return acc;\n    }, {});\n\n    // boolean properties - only attach if they are truthy\n    const booleanProps = booleanProperties.reduce((acc, name) => {\n      if (rest[name] === true || rest[name] === 'true') {\n        return { ...acc, [camelToKebabCase(name)]: true };\n      }\n      return acc;\n    }, {});\n\n    const slots = slotProperties.reduce((acc, name) => {\n      const slotValue = rest[name] as ReactElement;\n\n      if (!slotValue) return acc;\n\n      const slottedChildren = [];\n      let index = 0;\n      const removeFragments = (element) => {\n        if (!element) return;\n        if (element.type === React.Fragment) {\n          Children.toArray(element.props?.children)\n            .filter(Boolean)\n            .forEach((item) => {\n              removeFragments(item);\n            });\n        } else {\n          slottedChildren.push(\n            cloneElement(element, {\n              key: `${name}-${index}`,\n              slot: name\n            })\n          );\n          index++;\n        }\n      };\n\n      if (Array.isArray(slotValue)) {\n        slotValue.forEach((item) => {\n          removeFragments(item);\n        });\n      } else {\n        removeFragments(slotValue);\n      }\n      return [...acc, ...slottedChildren];\n    }, []);\n    // event binding\n    useEffect(\n      () => {\n        eventProperties.forEach((eventName) => {\n          const eventHandler = rest[createEventPropName(eventName)] as EventHandler;\n          if (typeof eventHandler === 'function') {\n            eventRegistry.current[eventName] = eventHandler;\n            ref.current.addEventListener(eventName, eventRegistry.current[eventName]);\n          }\n        });\n\n        return () => {\n          // eslint-disable-next-line guard-for-in\n          for (const eventName in eventRegistry.current) {\n            ref.current?.removeEventListener(eventName, eventRegistry.current[eventName]);\n          }\n        };\n      },\n      eventProperties.map((eventName) => rest[createEventPropName(eventName)])\n    );\n\n    // non web component related props, just pass them\n    const nonWebComponentRelatedProps = Object.entries(rest)\n      .filter(([key]) => !regularProperties.includes(key))\n      .filter(([key]) => !slotProperties.includes(key))\n      .filter(([key]) => !booleanProperties.includes(key))\n      .filter(([key]) => !eventProperties.map((eventName) => createEventPropName(eventName)).includes(key))\n      .reduce((acc, [key, val]) => ({ ...acc, [key]: val }), {});\n\n    const tagNameSuffix: string = getEffectiveScopingSuffixForTag(tagName);\n    const Component = ((tagNameSuffix ? `${tagName}-${tagNameSuffix}` : tagName) as unknown) as ComponentType<\n      WithWebComponentPropTypes & { class: string }\n    >;\n\n    return (\n      <Component\n        ref={ref}\n        {...booleanProps}\n        {...regularProps}\n        {...nonWebComponentRelatedProps}\n        class={className}\n        title={tooltip}\n      >\n        {slots}\n        {children}\n      </Component>\n    );\n  });\n\n  WithWebComponent.displayName = `WithWebComponent(${tagName})`;\n\n  return (WithWebComponent as unknown) as ForwardRefRenderFunction<Ui5DomRef, T & WithWebComponentPropTypes>;\n};\n"],"names":["capitalizeFirstLetter","s","charAt","toUpperCase","slice","camelToKebabCase","replace","a","b","toLowerCase","kebabToCamelCase","str","g","createEventPropName","eventName","withWebComponent","tagName","regularProperties","booleanProperties","slotProperties","eventProperties","WithWebComponent","forwardRef","props","wcRef","className","tooltip","children","rest","ref","useConsolidatedRef","eventRegistry","useRef","regularProps","reduce","acc","name","hasOwnProperty","booleanProps","slots","slotValue","slottedChildren","index","removeFragments","element","type","React","Fragment","Children","toArray","filter","Boolean","forEach","item","push","cloneElement","key","slot","Array","isArray","useEffect","eventHandler","current","addEventListener","removeEventListener","map","nonWebComponentRelatedProps","Object","entries","includes","val","tagNameSuffix","getEffectiveScopingSuffixForTag","Component","displayName"],"mappings":";;;;;;;;;;AAiBA,IAAMA,qBAAqB,GAAG,SAAxBA,qBAAwB,CAACC,CAAD;AAAA,SAAeA,CAAC,CAACC,MAAF,CAAS,CAAT,EAAYC,WAAZ,KAA4BF,CAAC,CAACG,KAAF,CAAQ,CAAR,CAA3C;AAAA,CAA9B;;AAEA,IAAMC,gBAAgB,GAAG,SAAnBA,gBAAmB,CAACJ,CAAD;AAAA,SAAeA,CAAC,CAACK,OAAF,CAAU,UAAV,EAAsB,UAACC,CAAD,EAAIC,CAAJ;AAAA,sBAAsBA,CAAC,CAACC,WAAF,EAAtB;AAAA,GAAtB,CAAf;AAAA,CAAzB;;AACA,IAAMC,gBAAgB,GAAG,SAAnBA,gBAAmB,CAACC,GAAD;AAAA,SAAiBA,GAAG,CAACL,OAAJ,CAAY,WAAZ,EAAyB,UAACM,CAAD;AAAA,WAAOA,CAAC,CAAC,CAAD,CAAD,CAAKT,WAAL,EAAP;AAAA,GAAzB,CAAjB;AAAA,CAAzB;;AAEA,IAAMU,mBAAmB,GAAG,SAAtBA,mBAAsB,CAACC,SAAD;AAAA,qBAAoBd,qBAAqB,CAACU,gBAAgB,CAACI,SAAD,CAAjB,CAAzC;AAAA,CAA5B;;IASaC,gBAAgB,GAAG,SAAnBA,gBAAmB,CAC9BC,OAD8B,EAE9BC,iBAF8B,EAG9BC,iBAH8B,EAI9BC,cAJ8B,EAK9BC,eAL8B,EAM3B;AACH,MAAMC,gBAAgB,gBAAGC,UAAU,CAAC,UAACC,KAAD,EAAuCC,KAAvC,EAAuE;AAAA,QACjGC,SADiG,GACvDF,KADuD,CACjGE,SADiG;AAAA,QACtFC,OADsF,GACvDH,KADuD,CACtFG,OADsF;AAAA,QAC7EC,QAD6E,GACvDJ,KADuD,CAC7EI,QAD6E;AAAA,QAChEC,IADgE,4BACvDL,KADuD;;AAGzG,QAAMM,GAAG,GAAGC,kBAAkB,CAAcN,KAAd,CAA9B;AACA,QAAMO,aAAa,GAAGC,MAAM,CAA+B,EAA/B,CAA5B,CAJyG;;AAOzG,QAAMC,YAAY,GAAGhB,iBAAiB,CAACiB,MAAlB,CAAyB,UAACC,GAAD,EAAMC,IAAN,EAAe;AAC3D,UAAIR,IAAI,CAACS,cAAL,CAAoBD,IAApB,CAAJ,EAA+B;AAC7B,+CAAYD,GAAZ,2BAAkB9B,gBAAgB,CAAC+B,IAAD,CAAlC,EAA2CR,IAAI,CAACQ,IAAD,CAA/C;AACD;;AACD,aAAOD,GAAP;AACD,KALoB,EAKlB,EALkB,CAArB,CAPyG;;AAezG,QAAMG,YAAY,GAAGpB,iBAAiB,CAACgB,MAAlB,CAAyB,UAACC,GAAD,EAAMC,IAAN,EAAe;AAC3D,UAAIR,IAAI,CAACQ,IAAD,CAAJ,KAAe,IAAf,IAAuBR,IAAI,CAACQ,IAAD,CAAJ,KAAe,MAA1C,EAAkD;AAChD,+CAAYD,GAAZ,2BAAkB9B,gBAAgB,CAAC+B,IAAD,CAAlC,EAA2C,IAA3C;AACD;;AACD,aAAOD,GAAP;AACD,KALoB,EAKlB,EALkB,CAArB;AAOA,QAAMI,KAAK,GAAGpB,cAAc,CAACe,MAAf,CAAsB,UAACC,GAAD,EAAMC,IAAN,EAAe;AACjD,UAAMI,SAAS,GAAGZ,IAAI,CAACQ,IAAD,CAAtB;AAEA,UAAI,CAACI,SAAL,EAAgB,OAAOL,GAAP;AAEhB,UAAMM,eAAe,GAAG,EAAxB;AACA,UAAIC,KAAK,GAAG,CAAZ;;AACA,UAAMC,eAAe,GAAG,SAAlBA,eAAkB,CAACC,OAAD,EAAa;AACnC,YAAI,CAACA,OAAL,EAAc;;AACd,YAAIA,OAAO,CAACC,IAAR,KAAiBC,KAAK,CAACC,QAA3B,EAAqC;AAAA;;AACnCC,UAAAA,QAAQ,CAACC,OAAT,mBAAiBL,OAAO,CAACrB,KAAzB,mDAAiB,eAAeI,QAAhC,EACGuB,MADH,CACUC,OADV,EAEGC,OAFH,CAEW,UAACC,IAAD,EAAU;AACjBV,YAAAA,eAAe,CAACU,IAAD,CAAf;AACD,WAJH;AAKD,SAND,MAMO;AACLZ,UAAAA,eAAe,CAACa,IAAhB,eACEC,YAAY,CAACX,OAAD,EAAU;AACpBY,YAAAA,GAAG,YAAKpB,IAAL,cAAaM,KAAb,CADiB;AAEpBe,YAAAA,IAAI,EAAErB;AAFc,WAAV,CADd;AAMAM,UAAAA,KAAK;AACN;AACF,OAjBD;;AAmBA,UAAIgB,KAAK,CAACC,OAAN,CAAcnB,SAAd,CAAJ,EAA8B;AAC5BA,QAAAA,SAAS,CAACY,OAAV,CAAkB,UAACC,IAAD,EAAU;AAC1BV,UAAAA,eAAe,CAACU,IAAD,CAAf;AACD,SAFD;AAGD,OAJD,MAIO;AACLV,QAAAA,eAAe,CAACH,SAAD,CAAf;AACD;;AACD,0CAAWL,GAAX,GAAmBM,eAAnB;AACD,KAlCa,EAkCX,EAlCW,CAAd,CAtByG;;AA0DzGmB,IAAAA,SAAS,CACP,YAAM;AACJxC,MAAAA,eAAe,CAACgC,OAAhB,CAAwB,UAACtC,SAAD,EAAe;AACrC,YAAM+C,YAAY,GAAGjC,IAAI,CAACf,mBAAmB,CAACC,SAAD,CAApB,CAAzB;;AACA,YAAI,OAAO+C,YAAP,KAAwB,UAA5B,EAAwC;AACtC9B,UAAAA,aAAa,CAAC+B,OAAd,CAAsBhD,SAAtB,IAAmC+C,YAAnC;AACAhC,UAAAA,GAAG,CAACiC,OAAJ,CAAYC,gBAAZ,CAA6BjD,SAA7B,EAAwCiB,aAAa,CAAC+B,OAAd,CAAsBhD,SAAtB,CAAxC;AACD;AACF,OAND;AAQA,aAAO,YAAM;AACX;AACA,aAAK,IAAMA,SAAX,IAAwBiB,aAAa,CAAC+B,OAAtC,EAA+C;AAAA;;AAC7C,0BAAAjC,GAAG,CAACiC,OAAJ,8DAAaE,mBAAb,CAAiClD,SAAjC,EAA4CiB,aAAa,CAAC+B,OAAd,CAAsBhD,SAAtB,CAA5C;AACD;AACF,OALD;AAMD,KAhBM,EAiBPM,eAAe,CAAC6C,GAAhB,CAAoB,UAACnD,SAAD;AAAA,aAAec,IAAI,CAACf,mBAAmB,CAACC,SAAD,CAApB,CAAnB;AAAA,KAApB,CAjBO,CAAT,CA1DyG;;AA+EzG,QAAMoD,2BAA2B,GAAGC,MAAM,CAACC,OAAP,CAAexC,IAAf,EACjCsB,MADiC,CAC1B;AAAA;AAAA,UAAEM,GAAF;;AAAA,aAAW,CAACvC,iBAAiB,CAACoD,QAAlB,CAA2Bb,GAA3B,CAAZ;AAAA,KAD0B,EAEjCN,MAFiC,CAE1B;AAAA;AAAA,UAAEM,GAAF;;AAAA,aAAW,CAACrC,cAAc,CAACkD,QAAf,CAAwBb,GAAxB,CAAZ;AAAA,KAF0B,EAGjCN,MAHiC,CAG1B;AAAA;AAAA,UAAEM,GAAF;;AAAA,aAAW,CAACtC,iBAAiB,CAACmD,QAAlB,CAA2Bb,GAA3B,CAAZ;AAAA,KAH0B,EAIjCN,MAJiC,CAI1B;AAAA;AAAA,UAAEM,GAAF;;AAAA,aAAW,CAACpC,eAAe,CAAC6C,GAAhB,CAAoB,UAACnD,SAAD;AAAA,eAAeD,mBAAmB,CAACC,SAAD,CAAlC;AAAA,OAApB,EAAmEuD,QAAnE,CAA4Eb,GAA5E,CAAZ;AAAA,KAJ0B,EAKjCtB,MALiC,CAK1B,UAACC,GAAD;AAAA;AAAA,UAAOqB,GAAP;AAAA,UAAYc,GAAZ;;AAAA,6CAA2BnC,GAA3B,2BAAiCqB,GAAjC,EAAuCc,GAAvC;AAAA,KAL0B,EAKqB,EALrB,CAApC;AAOA,QAAMC,aAAqB,GAAGC,+BAA+B,CAACxD,OAAD,CAA7D;AACA,QAAMyD,SAAS,GAAKF,aAAa,aAAMvD,OAAN,cAAiBuD,aAAjB,IAAmCvD,OAApE;AAIA,wBACE,oBAAC,SAAD;AACE,MAAA,GAAG,EAAEa;AADP,OAEMS,YAFN,EAGML,YAHN,EAIMiC,2BAJN;AAKE,eAAOzC,SALT;AAME,MAAA,KAAK,EAAEC;AANT,QAQGa,KARH,EASGZ,QATH,CADF;AAaD,GAxGkC,CAAnC;AA0GAN,EAAAA,gBAAgB,CAACqD,WAAjB,8BAAmD1D,OAAnD;AAEA,SAAQK,gBAAR;AACD;;;;"}